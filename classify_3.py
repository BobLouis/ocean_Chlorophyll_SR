lat_arr = [21.010000000000012, 21.030000000000037, 21.051000000000062, 21.071000000000087, 21.09100000000011, 21.111000000000136, 21.13100000000016, 21.150000000000183, 21.170000000000208, 21.190000000000232, 21.211000000000258, 21.231000000000282, 21.251000000000307, 21.27100000000033, 21.290000000000354, 21.31000000000038, 21.330000000000403, 21.350000000000428, 21.370000000000452, 21.391000000000478, 21.411000000000502, 21.431000000000527, 21.45000000000055, 21.470000000000574, 21.4900000000006, 21.510000000000623, 21.530000000000648, 21.551000000000673, 21.571000000000698, 21.591000000000722, 21.611000000000747, 21.63100000000077, 21.650000000000794, 21.67000000000082, 21.690000000000843, 21.731000000000893, 21.751000000000918, 21.771000000000942, 21.790000000000965, 21.81000000000099, 21.830000000001014, 21.85000000000104, 21.870000000001063, 21.89100000000109, 21.911000000001113, 21.931000000001138, 21.95000000000116, 21.970000000001185, 21.99000000000121, 22.010000000001234, 22.03000000000126, 22.051000000001284, 22.07100000000131, 22.091000000001333, 22.111000000001358, 22.131000000001382, 22.150000000001405, 22.17000000000143, 22.190000000001454, 22.21100000000148, 22.231000000001504, 22.25100000000153, 22.271000000001553, 22.290000000001577, 22.3100000000016, 22.330000000001625, 22.35000000000165, 22.370000000001674, 22.3910000000017, 22.43100000000175, 22.450000000001772, 22.470000000001797, 22.49000000000182, 22.510000000001845, 22.53000000000187, 22.551000000001896, 22.57100000000192, 22.591000000001944, 22.610000000001968, 22.630000000001992, 22.650000000002017, 22.67000000000204, 22.690000000002065, 22.71100000000209, 22.731000000002116, 22.75100000000214, 22.771000000002164, 22.790000000002188, 22.810000000002212, 22.830000000002237, 22.85000000000226, 22.870000000002285, 22.89100000000231, 22.911000000002335, 22.93100000000236, 22.950000000002383, 22.990000000002432, 23.010000000002456, 23.03000000000248, 23.051000000002507, 23.07100000000253, 23.091000000002555, 23.11000000000258, 23.130000000002603, 23.150000000002628, 23.170000000002652, 23.190000000002676, 23.211000000002702, 23.231000000002727, 23.25100000000275, 23.271000000002775, 23.2900000000028, 23.310000000002823, 23.330000000002848, 23.350000000002872, 23.370000000002896, 23.391000000002922, 23.411000000002947, 23.43100000000297, 23.47000000000302, 23.490000000003043, 23.510000000003068, 23.530000000003092, 23.551000000003118, 23.571000000003142, 23.591000000003167, 23.61000000000319, 23.630000000003214, 23.65000000000324, 23.670000000003263, 23.690000000003288, 23.711000000003313, 23.731000000003338, 23.751000000003362, 23.771000000003387, 23.79000000000341, 23.810000000003434, 23.83000000000346, 23.850000000003483, 23.870000000003508, 23.891000000003533, 23.911000000003558, 23.931000000003582, 23.950000000003605,
           23.97000000000363, 23.990000000003654, 24.01000000000368, 24.030000000003703, 24.05100000000373, 24.071000000003753, 24.091000000003778, 24.1100000000038, 24.130000000003825, 24.15000000000385, 24.170000000003874, 24.1900000000039, 24.211000000003924, 24.23100000000395, 24.251000000003973, 24.271000000003998, 24.310000000004045, 24.33000000000407, 24.350000000004094, 24.37000000000412, 24.391000000004144, 24.41100000000417, 24.431000000004193, 24.450000000004216, 24.47000000000424, 24.490000000004265, 24.51000000000429, 24.530000000004314, 24.55100000000434, 24.571000000004364, 24.59100000000439, 24.610000000004412, 24.630000000004436, 24.670000000004485, 24.69000000000451, 24.711000000004535, 24.73100000000456, 24.751000000004584, 24.77100000000461, 24.790000000004632, 24.810000000004656, 24.83000000000468, 24.850000000004705, 24.87000000000473, 24.891000000004755, 24.91100000000478, 24.931000000004804, 24.950000000004827, 24.970000000004852, 25.0100000000049, 25.030000000004925, 25.05100000000495, 25.071000000004975, 25.091000000005, 25.110000000005023, 25.130000000005047, 25.150000000005072, 25.170000000005096, 25.19000000000512, 25.211000000005146, 25.23100000000517, 25.251000000005195, 25.27100000000522, 25.290000000005243, 25.310000000005267, 25.330000000005292, 25.350000000005316, 25.37000000000534, 25.391000000005366, 25.41100000000539, 25.431000000005415, 25.45000000000544, 25.470000000005463, 25.490000000005487, 25.510000000005512, 25.530000000005536, 25.551000000005562, 25.571000000005586, 25.59100000000561, 25.610000000005634, 25.63000000000566, 25.650000000005683, 25.670000000005707, 25.690000000005732, 25.711000000005757, 25.731000000005782, 25.751000000005806, 25.77100000000583, 25.790000000005854, 25.81000000000588, 25.830000000005903, 25.850000000005927, 25.870000000005952, 25.891000000005977, 25.931000000006026, 25.95000000000605, 25.970000000006074, 25.9900000000061, 26.010000000006123, 26.030000000006147, 26.051000000006173, 26.071000000006197, 26.091000000006222, 26.110000000006245, 26.13000000000627, 26.150000000006294, 26.190000000006343, 26.21100000000637, 26.231000000006393, 26.251000000006417, 26.271000000006442, 26.290000000006465, 26.31000000000649, 26.330000000006514, 26.35000000000654, 26.370000000006563, 26.39100000000659, 26.411000000006613, 26.45000000000666, 26.470000000006685, 26.49000000000671, 26.510000000006734, 26.53000000000676, 26.551000000006784, 26.57100000000681, 26.591000000006833, 26.610000000006856, 26.63000000000688, 26.650000000006905, 26.67000000000693, 26.71100000000698, 26.731000000007004, 26.75100000000703, 26.771000000007053, 26.790000000007076, 26.8100000000071, 26.830000000007125, 26.85000000000715, 26.870000000007174, 26.8910000000072, 26.911000000007224, 26.95000000000727, 26.970000000007296, 26.99000000000732]

lon_arr = [117.01000000000005, 117.03100000000015, 117.05000000000024, 117.07000000000033, 117.09100000000043, 117.11000000000053, 117.13000000000062, 117.17100000000082, 117.19000000000091, 117.210000000001, 117.2300000000011, 117.2500000000012, 117.27000000000129, 117.29000000000138, 117.31100000000148, 117.35000000000167, 117.37000000000177, 117.39000000000186, 117.41000000000196, 117.43000000000205, 117.45100000000215, 117.47000000000224, 117.51000000000244, 117.53100000000254, 117.55000000000263, 117.57000000000272, 117.59100000000282, 117.61000000000291, 117.63000000000301, 117.6710000000032, 117.6900000000033, 117.71000000000339, 117.73000000000349, 117.75000000000358, 117.77000000000368, 117.79000000000377, 117.81100000000387, 117.85000000000406, 117.87000000000415, 117.89000000000425, 117.91000000000435, 117.93000000000444, 117.95100000000454, 117.97000000000463, 117.99000000000473, 118.03100000000492, 118.05000000000501, 118.07000000000511, 118.09100000000521, 118.1100000000053, 118.1300000000054, 118.15000000000549, 118.17100000000559, 118.21000000000578, 118.23000000000587, 118.25000000000597, 118.27000000000606, 118.29000000000616, 118.31100000000626, 118.33000000000635, 118.35000000000645, 118.39000000000664, 118.41000000000673, 118.43000000000683, 118.45100000000693, 118.47000000000702, 118.49000000000711, 118.51000000000721, 118.53100000000731, 118.5700000000075, 118.5910000000076, 118.61000000000769, 118.63000000000778, 118.65000000000788, 118.67100000000798, 118.69000000000807, 118.71000000000816, 118.75000000000836, 118.77000000000845, 118.79000000000855, 118.81100000000865, 118.83000000000874, 118.85000000000883, 118.87000000000893, 118.89000000000902, 118.91000000000912, 118.95100000000932, 118.9700000000094, 118.9900000000095, 119.0100000000096, 119.0310000000097, 119.05000000000979, 119.07000000000988, 119.09100000000998, 119.13000000001017, 119.15000000001027, 119.17100000001037, 119.19000000001046, 119.21000000001055, 119.23000000001065, 119.25000000001074, 119.27000000001084, 119.29000000001093, 119.33000000001113, 119.35000000001122, 119.37000000001132, 119.39000000001141, 119.41000000001151, 119.4300000000116, 119.4510000000117, 119.4700000000118, 119.49000000001189, 119.53100000001209, 119.55000000001218, 119.57000000001227, 119.59100000001237, 119.61000000001246, 119.63000000001256, 119.65000000001265, 119.67100000001275, 119.69000000001284, 119.73000000001304, 119.75000000001313, 119.77000000001323, 119.79000000001332, 119.81100000001342, 119.83000000001351, 119.85000000001361, 119.8700000000137, 119.8900000000138, 119.9100000000139, 119.95100000001409, 119.97000000001418, 119.99000000001428, 120.01000000001437, 120.03100000001447, 120.05000000001456,
           120.07000000001466, 120.09100000001476, 120.11000000001485, 120.15000000001504, 120.17100000001514, 120.19000000001523, 120.21000000001533, 120.23000000001542, 120.25000000001552, 120.27000000001561, 120.29000000001571, 120.31100000001581, 120.3300000000159, 120.37000000001609, 120.39000000001619, 120.41000000001628, 120.43000000001638, 120.45100000001648, 120.47000000001657, 120.49000000001666, 120.51000000001676, 120.53100000001686, 120.55000000001695, 120.59100000001715, 120.61000000001724, 120.63000000001733, 120.65000000001743, 120.67100000001753, 120.69000000001762, 120.71000000001771, 120.73000000001781, 120.7500000000179, 120.770000000018, 120.8110000000182, 120.83000000001829, 120.85000000001838, 120.87000000001848, 120.89000000001857, 120.91000000001867, 120.93000000001877, 120.95100000001887, 120.97000000001896, 120.99000000001905, 121.01000000001915, 121.05000000001934, 121.07000000001943, 121.09100000001953, 121.11000000001962, 121.13000000001972, 121.15000000001982, 121.17100000001992, 121.19000000002, 121.2100000000201, 121.2300000000202, 121.2500000000203, 121.29000000002048, 121.31100000002058, 121.33000000002068, 121.35000000002077, 121.37000000002087, 121.39000000002096, 121.41000000002106, 121.43000000002115, 121.45100000002125, 121.47000000002134, 121.49000000002144, 121.53100000002163, 121.55000000002173, 121.57000000002182, 121.59100000002192, 121.61000000002201, 121.63000000002211, 121.6500000000222, 121.6710000000223, 121.6900000000224, 121.71000000002249, 121.73000000002259, 121.75000000002268, 121.77000000002278, 121.79000000002287, 121.81100000002297, 121.83000000002306, 121.85000000002316, 121.87000000002325, 121.89000000002335, 121.91000000002344, 121.93000000002354, 121.95100000002364, 121.97000000002373, 121.99000000002383, 122.03100000002402, 122.05000000002411, 122.07000000002421, 122.09100000002431, 122.1100000000244, 122.1300000000245, 122.15000000002459, 122.17100000002469, 122.19000000002478, 122.21000000002488, 122.23000000002497, 122.25000000002507, 122.29000000002526, 122.31100000002536, 122.33000000002545, 122.35000000002555, 122.37000000002564, 122.39000000002574, 122.41000000002583, 122.43000000002593, 122.45100000002603, 122.47000000002612, 122.49000000002621, 122.51000000002631, 122.53100000002641, 122.5700000000266, 122.5910000000267, 122.61000000002679, 122.63000000002688, 122.65000000002698, 122.67100000002708, 122.69000000002717, 122.71000000002726, 122.73000000002736, 122.75000000002746, 122.77000000002755, 122.79000000002765, 122.81100000002775, 122.85000000002793, 122.87000000002803, 122.89000000002812, 122.91000000002822, 122.93000000002831, 122.95100000002842, 122.9700000000285, 122.9900000000286]


spots = [
    [24.310037, 120.491169],
    [22.761827, 121.178903],
    [23.540991, 119.625357],
    [23.662595, 120.061605],
    [23.365493, 120.119036],
    [24.411452, 120.585687],
    [25.126694, 121.864277],
    [23.827345, 120.15133],
    [25.131742, 121.829123],
    [24.841557, 120.907177],
    [24.868144, 120.92978],
    [24.806303, 120.832628],
    [24.912114, 120.955767],
    [24.828021, 121.943413],
    [24.840068, 121.832146],
    [24.714734, 121.841711],
    [24.631525, 121.856735],
    [24.593861, 121.884555],
    [24.315765, 121.786608],
    [24.298113, 121.833917],
    [24.300055, 121.776009],
    [24.13874, 121.669926],
    [23.969075, 121.624848],
    [23.944379, 121.615711],
    [23.599472, 121.534833],
    [23.459638, 121.526013],
    [24.69257, 120.790144],
    [24.68417, 120.816888],
    [24.490158, 120.659172],
    [25.164942, 121.752047],
    [25.163691, 121.760548],
    [25.188152, 121.764101],
    [25.150636, 121.801701],
    [25.166219, 121.76483],
    [25.045389, 121.938777],
    [24.182981, 120.43258],
    [24.153874, 120.407163],
    [24.107958, 120.381248],
    [23.868341, 120.204553],
    [23.863066, 120.178273],
    [23.866156, 120.182572],
    [25.222152, 121.363775],
    [25.222617, 121.40077],
    [25.133152, 121.306794],
    [25.134899, 121.83527],
    [25.207526, 121.370855],
    [25.127983, 121.300885],
    [25.1255, 121.257305],
    [25.12237, 121.245769],
    [25.12133, 121.197207],
    [25.130409, 121.219458],
    [25.056026, 121.064251],
    [22.920129, 120.161175],
    [22.910101, 120.151647],
    [22.910517, 120.172147],
    [22.910659, 120.114481],
    [22.637319, 120.244741],
    [22.611874, 120.244184],
    [22.559261, 120.287041],
    [22.587929, 120.26271],
    [22.476117, 120.39373],
    [22.471309, 120.428812],
    [22.413756, 120.392698],
    [22.471587, 120.422062],
    [22.464559, 120.433756],
    [22.435918, 120.483032],
    [22.438973, 120.48556],
    [21.92546, 120.75636],
    [21.930821, 120.752666],
    [21.950876, 120.76014],
    [24.334846, 120.456334],
    [24.202987, 120.478358],
    [24.20855, 120.42518],
    [21.943127, 120.746167],
    [21.94981, 120.771418],
    [21.942736, 120.784389],
    [22.703887, 121.101178],
    [22.78466, 121.190737],
    [23.084344, 121.37903],
    [22.064062, 121.504913],
    [22.657868, 121.471115],
    [22.750991, 121.23079],
    [23.507326, 119.597328],
    [23.552544, 119.672052],
    [23.733909, 119.615619],
    [23.190112, 119.417672],
    [23.801924, 120.168943],
    [23.720181, 120.118126],
    [23.538268, 120.13368],
    [23.432021, 120.108234],
    [23.437105, 120.102818],
    [23.398299, 120.107954],
    [23.390075, 120.130454],
    [23.434245, 120.065429],
    [22.889351, 120.158479],
    [25.127983, 121.300885],
    [25.131742, 121.829123],
    [23.348329, 119.524486],
    [23.515498, 119.486607],
    [25.128573, 121.843846],
    [24.466526, 118.35228],
    [24.405262, 118.281898],
    [24.439336, 118.475189],
    [26.173927, 119.924698],
    [26.194569, 119.94976],
    [26.236458, 120.018425],
    [26.3951018, 120.4794351],
    [25.088015, 121.1719546],
    [25.12718, 121.14665],
    [25.0617401, 121.0960475],
    [25.0983815, 121.0670128],
    [24.6223673, 120.7420289],
    [24.65063, 120.71113],
    [24.42936, 120.55126],
    [24.09032, 120.36735],
    [24.08932, 120.32405],
    [23.556051, 120.1078203],
    [23.3365059, 120.0671021],
    [23.04167, 120.06049],
    [23.01773, 120.10614],
    [22.99342, 120.13667],
    [22.9977917, 120.0527641],
    [22.9738554, 120.090843],
    [22.8037086, 120.2130233],
    [22.78236, 120.14981],
    [22.52162, 120.32618],
    [22.50405, 120.32995],
]


north_med_divider = 24.3681
south_med_divider = 23.6011

# Initialize lists to hold the spots for each region
north_spots = []
central_spots = []
south_spots = []

# Classify each spot by latitude
for spot in spots:
    latitude = spot[0]
    if latitude >= north_med_divider:
        north_spots.append(spot)
    elif latitude < south_med_divider:
        south_spots.append(spot)
    else:
        central_spots.append(spot)


prev_lat = 0
tmp = []
for i in lat_arr:
    delta = i - prev_lat
    # print(delta)
    if (delta > 0.03 and delta < 10):
        tmp.append((i+prev_lat)/2)
    prev_lat = i

lat_arr.extend(tmp)  # Add new midpoints to the original list
lat_arr.sort()       # Sort the list in place, do not assign the result


prev_lon = 0
tmp = []
for i in lon_arr:
    delta = i - prev_lon
    # print(delta)
    if (delta > 0.03 and delta < 10):
        tmp.append((i+prev_lon)/2)
    prev_lon = i

lon_arr.extend(tmp)  # Add new midpoints to the original list
lon_arr.sort()       # Sort the list in place, do not assign the result


# test
prev_lon = 0
for i in lon_arr:
    delta = i - prev_lon
    if (delta > 0.022 or delta < 0.018):
        print(delta)
    prev_lon = i

# test
prev_lat = 0
for i in lat_arr:
    delta = i - prev_lat
    if (delta > 0.022 or delta < 0.018):
        print(delta)
    prev_lat = i


def find_closest(arr, coord):
    valid_indices = [i for i, x in enumerate(arr) if x < coord]

    if not valid_indices:
        return None

    closest_index = max(valid_indices, key=lambda i: arr[i])
    return closest_index


# Function to classify a spot into one of the 16 sub-grids within the found grid cell


def classify_into_subgrid(lat_index, lon_index, lat, lon):
    lat_sub_division = (lat_arr[lat_index+1] - lat_arr[lat_index]) / 4
    lon_sub_division = (lon_arr[lon_index+1] - lon_arr[lon_index]) / 4

    lat_sub_index = int((lat - lat_arr[lat_index]) / lat_sub_division)
    lon_sub_index = int((lon - lon_arr[lon_index]) / lon_sub_division)

    # Adjust in case the division falls right on the boundary
    if lat_sub_index == 4:
        lat_sub_index = 3
    if lon_sub_index == 4:
        lon_sub_index = 3

    return lat_sub_index * 4 + lon_sub_index


palace_grid_count_total = {i: 0 for i in range(16)}

# Classify each spot
for lat, lon in spots:
    lat_index = find_closest(lat_arr, lat)
    lon_index = find_closest(lon_arr, lon)
    subgrid_index = classify_into_subgrid(lat_index, lon_index, lat, lon)
    palace_grid_count_total[subgrid_index] += 1


# Dictionary to store the count of spots in each sub-grid
palace_grid_count_north = {i: 0 for i in range(16)}

# Classify north spot
for lat, lon in north_spots:
    lat_index = find_closest(lat_arr, lat)
    lon_index = find_closest(lon_arr, lon)
    subgrid_index = classify_into_subgrid(lat_index, lon_index, lat, lon)
    palace_grid_count_north[subgrid_index] += 1


palace_grid_count_central = {i: 0 for i in range(16)}

# Classify med spot
for lat, lon in central_spots:
    lat_index = find_closest(lat_arr, lat)
    lon_index = find_closest(lon_arr, lon)
    subgrid_index = classify_into_subgrid(lat_index, lon_index, lat, lon)
    palace_grid_count_central[subgrid_index] += 1


palace_grid_count_south = {i: 0 for i in range(16)}

# Classify each spot
for lat, lon in south_spots:
    lat_index = find_closest(lat_arr, lat)
    lon_index = find_closest(lon_arr, lon)
    subgrid_index = classify_into_subgrid(lat_index, lon_index, lat, lon)
    palace_grid_count_south[subgrid_index] += 1


def add_similar(dict):
    ret = [0, 0, 0, 0]
    ret[0] = dict[0] + dict[3] + dict[12] + dict[15]
    ret[1] = dict[1] + dict[2] + dict[13] + dict[14]
    ret[2] = dict[4] + dict[8] + dict[7] + dict[11]
    ret[3] = dict[5] + dict[6] + dict[9] + dict[10]
    return ret


print("all spots")
print(palace_grid_count_total)
print("north spots")
print(palace_grid_count_north)
print("central spots")
print(palace_grid_count_central)
print("south spots")
print(palace_grid_count_south)

total_sum = sum(palace_grid_count_total.values())
total_sum_north = sum(palace_grid_count_north.values())
total_sum_central = sum(palace_grid_count_central.values())
total_sum_south = sum(palace_grid_count_south.values())


print("Total sum of all values:", total_sum)
print("similar grid", add_similar(palace_grid_count_total))
print("Total sum of north values:", total_sum_north)
print("similar grid", add_similar(palace_grid_count_north))
print("Total sum of central values:", total_sum_central)
print("similar grid", add_similar(palace_grid_count_central))
print("Total sum of south values:", total_sum_south)
print("similar grid", add_similar(palace_grid_count_south))
